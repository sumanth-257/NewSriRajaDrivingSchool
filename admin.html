<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Attendance Approval</title>
<style>
body { font-family:'Segoe UI',sans-serif; background:#f1f5f9; margin:0; padding:0; }
header { background:#0f172a; color:white; padding:15px; text-align:center; }
#loginBox, #recordsBox { max-width:700px; margin:40px auto; background:white; padding:20px; border-radius:8px; box-shadow:0 4px 10px rgba(0,0,0,0.1); }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #cbd5e1; padding:8px; text-align:center; }
button { background:#1e40af; color:white; border:none; padding:6px 10px; border-radius:5px; cursor:pointer; }
button:hover { background:#3b82f6; }
button.deny { background:#dc2626; }
button.deny:hover { background:#ef4444; }
</style>
</head>
<body>
<header><h2>Admin - Approve / Deny Attendance</h2></header>

<div id="loginBox">
  <label>Enter Admin Password:</label>
  <input type="password" id="password" placeholder="Enter password">
  <button onclick="login()">Login</button>
  <p id="loginStatus"></p>
</div>

<div id="recordsBox" style="display:none;">
  <h3>Pending Attendance Requests</h3>
  <table id="pendingTable">
    <thead>
      <tr><th>Date</th><th>Phone</th><th>Name</th><th>Course</th><th>Timing</th><th>Actions</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const SCRIPT_URL = "YOUR_SCRIPT_WEBAPP_URL";

function login() {
  const pass = document.getElementById("password").value.trim();
  if (!pass) return;
  document.getElementById("loginStatus").textContent = "Verifying...";
  fetch(`${SCRIPT_URL}?password=${encodeURIComponent(pass)}&action=pending`)
    .then(res => res.json())
    .then(data => {
      if (data.status === "UNAUTHORIZED") {
        document.getElementById("loginStatus").textContent = "❌ Wrong password!";
      } else {
        document.getElementById("loginBox").style.display = "none";
        document.getElementById("recordsBox").style.display = "block";
        loadPending(data.records);
      }
    });
}

function loadPending(records) {
  const tbody = document.querySelector("#pendingTable tbody");
  tbody.innerHTML = "";
  if (records.length === 0) {
    tbody.innerHTML = "<tr><td colspan='6'>✅ No pending records</td></tr>";
    return;
  }
  records.forEach(r => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${new Date(r.date).toLocaleString()}</td>
      <td>${r.phone}</td>
      <td>${r.name}</td>
      <td>${r.course}</td>
      <td>${r.timing}</td>
      <td>
        <button onclick="approve('${r.phone}','${r.date}')">Approve</button>
        <button class="deny" onclick="deny('${r.phone}','${r.date}')">Deny</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

function approve(phone, dateVal) {
  fetch(`${SCRIPT_URL}?action=approve&phone=${encodeURIComponent(phone)}&date=${encodeURIComponent(dateVal)}`, { method: "POST" })
    .then(res => res.text())
    .then(() => { alert("✅ Approved!"); location.reload(); });
}

function deny(phone, dateVal) {
  fetch(`${SCRIPT_URL}?action=deny&phone=${encodeURIComponent(phone)}&date=${encodeURIComponent(dateVal)}`, { method: "POST" })
    .then(res => res.text())
    .then(() => { alert("❌ Request Denied"); location.reload(); });
}
</script>
</body>
</html>
